## Описание MarkReader
Проект содержит следующие компоненты:
- [ ] Фильтр-драйвер markreader.sys (директория filter), который считывает первые 1024 байта из файлов с расширениями указанными в его inf-файле:
[Common.AddRegistry]
HKR,"Parameters","Extensions",0x00010000,"doc","pdf","txt"

И отправляет их на проверку компоненту: 
- [ ] userclient.exe (директория user), который проверяет полученное содержимое (в текущей реализации файл запрещен к открытию, если в его содержимом в начале есть "NO")

Для тестирования стабильности и отсутствия утечек памяти драйвера реализован компонент:
- [ ] Test (директория Test) - консольная утилита, которая в бесконечном цикле по очереди открывает все файлы в директории С:\\tmp\\ до тех пор, пока не будет остановлена (Ctrl + C). Результат об успешном открытии или запрете доступа логируется в файл log.txt, создаваемый рядом с исполняемым файлом. В лог также выводится временная задержка между открытиями файлов.

## Установочные и исполняемые файлы
В директории release_packet лежат установочные и исполняемые файлы, откомпилированные в release-режиме, которые были скопированы и установлены на ранее предоставленную на корпоративных ресурсах виртуальную машину UC2022-VDI.UC2022.DSS. 

## Тестирование
Для тестирования использовались 144 файлов (половина с запретом) к которым шло обращение драйвера по кругу. 
Запускались тесты на 3, 6 и 14 часов. С лог файлами для каждого теста можно ознакомится в директории C:\Users\Public\MarkReader на UC2022-VDI.UC2022.DSS, так как они имеют большие размеры, здесь выложен фрагмент log_sample.txt из log_3_часа.txt 

Например, в тесте за 6 часов было выполнено почти 4,5 миллионов обращений к файлам. Размер лог-файла чуть более 300 МБ. Всего тесты были проведены примерно на 15000000 обращений на проверку прав. Временные задержки составляют в среднем 4-7 миллисекунды, что доказывает, что текущая реализация чтения метки драйвером из файла и анализ её содержимого в приложении на С++ в текущей реализации, мало влияет на производительность ПК, также это подтверждает производительность системы при нагрузочном тестировании - при использовании диска в пределах 40-50%, нагрузка на ЦП в среднем 42-48% (на Intel(R) Xeon(R) Platinum 8160 CPU @ 2.10GHz   2.10 GHz с ОП 3,37 ГБ). Пользователь может при этом пользоваться машиной, не замечая работы драйвера и и приложения.
Следует учесть, что обращения к защищаемым файлам идут БЕЗ ВСЯКОЙ ЗАДЕРЖКИ, что на практике никогда не бывает. 

```
Еще раз обращаю внимание: 
тест ЗАЦИКЛЕН БЕЗ ЗАДЕРЖЕК (!!!) на непрерывное обращение и проверку прав. 
На каждую проверку, на медленной виртуальной машине, тратится около 5 мс. 
Это очень хороший результат, который позволяет использовать данный подход в практических задачах 
и доказывает, что даже массовые обмены в том виде как они реализованы не влияют на производительность и стабильность системы.
```
Случайные выборочные проверки записей в лог-файлах показывают, что пара драйвер markreader.sys и userclient.exe работают корректно и стабильно. Синего экрана ни разу не было.

## Инструкция по запуску
Чтобы самостоятельно проверить работоспособность системы необходимо:
1) Установить драйвер
2) Убедиться, что драйвер DssFsMiniFilter НЕ загружен
3) Запустить драйвер markreader командой sc.exe start markreader
4) В консоли с правами администратора запустить userclient.exe

## Замечания: 
- [ ] если не запущено userclient.exe фильтрация открытия файлов не происходит
- [ ] фильтруемые расширения файлов можно добавлять путём добавления их в регистрационную базу с последующим перезапуском драйвера

## Сборка проекта
[Как установить необходимые компоненты для сборки драйвера](https://learn.microsoft.com/en-us/windows-hardware/drivers/develop/)

Скрипт сборки проекта для VS2022 - build.bat 